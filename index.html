<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crash Casino Game Demo — Live-Style Simulation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta
    name="description"
    content="Casino-style Crash game demo in your browser: live multiplier, round history, auto cashout, and virtual balance — no real money."
  />
  <style>
    :root {
      --bg: #050816;
      --bg-elevated: #101426;
      --bg-deep: #050712;
      --accent: #ffb800;
      --accent-soft: rgba(255, 184, 0, 0.12);
      --accent-strong: #ffdf66;
      --danger: #ff4466;
      --danger-soft: rgba(255, 68, 102, 0.12);
      --green: #38d996;
      --green-soft: rgba(56, 217, 150, 0.1);
      --text: #f5f5f8;
      --text-soft: #a0a3b1;
      --border: #22263b;
      --chip-blue: #4fa3ff;
      --chip-purple: #a56bff;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font-main);
      background:
        radial-gradient(circle at top, #212653 0, #050816 55%, #010208 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .kicker {
      font-size: 0.8rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--accent-strong);
    }

    h1 {
      font-size: clamp(1.9rem, 3vw, 2.5rem);
      font-weight: 700;
    }

    .lead {
      max-width: 720px;
      font-size: 0.95rem;
      color: var(--text-soft);
      line-height: 1.6;
    }

    /* Layout */
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2.3fr) minmax(0, 1.4fr);
      gap: 18px;
      align-items: flex-start;
    }

    @media (max-width: 950px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: radial-gradient(circle at top left, #20264b 0, #050816 55%);
      border-radius: 18px;
      padding: 16px 16px 18px;
      border: 1px solid var(--border);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(16px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-size: 0.88rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ffb800, #ffdf99);
      color: #160b00;
      box-shadow: 0 0 14px rgba(255, 184, 0, 0.4);
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    .round-info {
      text-align: right;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .round-id {
      font-weight: 600;
      color: #ffffff;
    }

    .phase-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 2px 10px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .phase-pill span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--green);
      box-shadow: 0 0 10px var(--green);
    }

    .phase-betting {
      border-color: rgba(79, 163, 255, 0.7);
      color: #9ac5ff;
    }

    .phase-running {
      border-color: rgba(255, 184, 0, 0.7);
      color: var(--accent-strong);
    }

    .phase-crashed {
      border-color: rgba(255, 68, 102, 0.8);
      color: #ff9bb0;
    }

    .phase-idle {
      border-color: rgba(255, 255, 255, 0.2);
      color: var(--text-soft);
    }

    .phase-countdown {
      font-family: var(--font-mono);
      margin-left: 6px;
      color: #ffffff;
    }

    /* Last multipliers row */
    .last-mults {
      display: flex;
      gap: 6px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .multi-chip {
      min-width: 36px;
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-family: var(--font-mono);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(8, 10, 30, 0.9);
      color: var(--text-soft);
    }

    .multi-low {
      background: var(--danger-soft);
      border-color: rgba(255, 68, 102, 0.6);
      color: #ffbccb;
    }

    .multi-mid {
      background: rgba(255, 184, 0, 0.14);
      border-color: rgba(255, 184, 0, 0.7);
      color: var(--accent-strong);
    }

    .multi-high {
      background: var(--green-soft);
      border-color: rgba(56, 217, 150, 0.7);
      color: #d2ffe9;
    }

    /* Graph / main game area */
    .graph-shell {
      margin-top: 6px;
      border-radius: 16px;
      padding: 12px 12px 10px;
      background: radial-gradient(circle at top, #262b5a 0, #050816 70%);
      border: 1px solid rgba(105, 128, 205, 0.7);
      position: relative;
      overflow: hidden;
      height: 260px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .graph-top-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .multiplier {
      font-size: 3.1rem;
      font-weight: 700;
      line-height: 1.1;
      text-shadow: 0 0 26px rgba(255, 184, 0, 0.8);
    }

    .multiplier.crashed {
      color: var(--danger);
      text-shadow: 0 0 26px rgba(255, 68, 102, 0.9);
    }

    .multiplier.cashed {
      color: var(--green);
      text-shadow: 0 0 26px rgba(56, 217, 150, 0.9);
    }

    .graph-canvas-wrap {
      position: relative;
      flex: 1;
      margin-top: 2px;
    }

    canvas#crash-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .rocket {
      position: absolute;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      border: 2px solid #ffffff;
      background: radial-gradient(circle at 30% 20%, #ffffff, #ffb800);
      box-shadow:
        0 0 10px rgba(255, 184, 0, 0.9),
        0 0 24px rgba(255, 184, 0, 0.8);
      transform: translate(-9999px, -9999px);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: #160b00;
    }

    .rocket::after {
      content: "▲";
      font-size: 0.7rem;
      transform: translateY(-1px);
    }

    .axis-labels {
      position: absolute;
      bottom: 6px;
      left: 10px;
      right: 10px;
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.6);
      pointer-events: none;
    }

    /* Bet panel */
    .bet-panel {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 10px;
      margin-top: 14px;
    }

    @media (max-width: 700px) {
      .bet-panel {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .field label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .field small {
      font-size: 0.7rem;
      opacity: 0.8;
    }

    input[type="number"] {
      width: 100%;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(9, 11, 30, 0.9);
      color: var(--text);
      font-family: inherit;
      font-size: 0.9rem;
      outline: none;
    }

    input[type="number"]:focus {
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px rgba(255, 184, 0, 0.35);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .btn-pill {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(8, 10, 30, 0.9);
      color: var(--text-soft);
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, border 0.08s ease,
        background 0.08s ease;
    }

    .btn-pill:hover {
      transform: translateY(-1px);
      border-color: rgba(255, 184, 0, 0.7);
      box-shadow: 0 0 12px rgba(255, 184, 0, 0.4);
    }

    .btn-row-main {
      display: flex;
      gap: 6px;
      margin-top: auto;
      justify-content: flex-end;
      align-items: center;
    }

    .btn {
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      font-family: inherit;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        background 0.08s ease, color 0.08s ease;
      white-space: nowrap;
    }

    .btn:active {
      transform: translateY(1px) scale(0.99);
    }

    .btn-primary {
      background: linear-gradient(135deg, #ffb800, #ffdf99);
      color: #160b00;
      box-shadow: 0 8px 18px rgba(255, 184, 0, 0.45);
    }

    .btn-primary[disabled] {
      background: #4a4a4a;
      color: #d2d2d2;
      box-shadow: none;
      cursor: default;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: var(--text-soft);
    }

    .btn-ghost.danger {
      border-color: rgba(255, 68, 102, 0.7);
      color: #ff9bb0;
    }

    .btn-ghost.tiny {
      padding: 5px 10px;
      font-size: 0.75rem;
    }

    .btn-ghost[disabled] {
      opacity: 0.3;
      cursor: default;
    }

    /* Sidebar */
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .balance-line {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 0.9rem;
    }

    .balance-amount {
      font-size: 1.15rem;
      font-weight: 600;
      font-family: var(--font-mono);
    }

    .balance-amount.positive {
      color: var(--green);
    }

    .balance-amount.negative {
      color: var(--danger);
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
      margin-top: 10px;
    }

    .metric-small {
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(6, 8, 22, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.06);
      font-size: 0.76rem;
    }

    .metric-label {
      color: var(--text-soft);
      margin-bottom: 3px;
    }

    .metric-value {
      font-family: var(--font-mono);
      font-size: 0.78rem;
    }

    .history-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 10px;
    }

    .history {
      margin-top: 6px;
      border-radius: 10px;
      background: rgba(6, 8, 22, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.06);
      max-height: 190px;
      overflow-y: auto;
      font-size: 0.78rem;
    }

    .history-row {
      display: grid;
      grid-template-columns: 1.3fr 1.1fr 1fr;
      gap: 4px;
      padding: 5px 8px;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.06);
      align-items: baseline;
    }

    .history-row:last-child {
      border-bottom: none;
    }

    .history-multi {
      font-family: var(--font-mono);
    }

    .history-win {
      color: var(--green);
    }

    .history-loss {
      color: var(--danger);
    }

    .history-tag {
      color: var(--text-soft);
      font-size: 0.7rem;
      text-align: right;
    }

    .note {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-top: 8px;
    }

    .note strong {
      color: var(--accent-strong);
    }

    .info-card {
      margin-top: 6px;
      padding: 10px 10px;
      border-radius: 12px;
      background: rgba(6, 8, 22, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .info-card h3 {
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: #ffffff;
    }

    .info-card ul {
      list-style: none;
      padding-left: 0;
      margin-top: 4px;
    }

    .info-card li {
      padding-left: 14px;
      position: relative;
      margin-bottom: 3px;
    }

    .info-card li::before {
      content: "•";
      position: absolute;
      left: 2px;
      color: var(--accent-strong);
    }

    /* Text content */
    .text-content {
      margin-top: 14px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 20px;
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    @media (max-width: 900px) {
      .text-content {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    h2 {
      font-size: 1.15rem;
      margin-bottom: 8px;
      margin-top: 4px;
    }

    h3 {
      font-size: 1rem;
      margin-bottom: 6px;
      margin-top: 8px;
      color: #ffffff;
    }

    p {
      margin-bottom: 8px;
      line-height: 1.6;
    }

    ul {
      list-style: none;
      padding-left: 0;
      margin-bottom: 8px;
    }

    ul li {
      padding-left: 16px;
      position: relative;
      margin-bottom: 4px;
    }

    ul li::before {
      content: "•";
      position: absolute;
      left: 4px;
      color: var(--accent-strong);
    }

    code {
      font-family: var(--font-mono);
      font-size: 0.8rem;
      background: rgba(6, 8, 22, 0.95);
      padding: 2px 4px;
      border-radius: 4px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    footer {
      border-top: 1px solid rgba(255, 255, 255, 0.12);
      padding: 12px 16px 16px;
      font-size: 0.76rem;
      color: var(--text-soft);
      text-align: center;
      background: radial-gradient(circle at top, #171932 0, #050816 65%);
    }
  </style>
</head>
<body>
  <main class="page">
    <header>
      <span class="kicker">Demo • Crash Casino-Style Game</span>
      <h1>Crash Casino Game Demo (Full Visual Simulation)</h1>
      <p class="lead">
        This page mimics a modern <strong>Crash casino game</strong>: animated multiplier curve,
        rocket flight, last results bar, auto cashout and live-style rounds. Everything runs on
        virtual credits only — no real-money deposits or payouts.
      </p>
    </header>

    <section class="layout">
      <!-- MAIN GAME -->
      <section class="card">
        <div class="card-header">
          <div class="title-row">
            <span class="logo">Crash Demo</span>
            <div class="subtitle">Live-style rounds • Virtual balance • Strategy sandbox</div>
          </div>
          <div class="round-info">
            <div>Round <span id="round-id" class="round-id">#1</span></div>
            <div id="phase-pill" class="phase-pill phase-idle">
              <span class="dot"></span>
              <span id="phase-label">Waiting</span>
              <span id="phase-countdown" class="phase-countdown"></span>
            </div>
          </div>
        </div>

        <div class="last-mults" id="last-mults">
          <!-- Filled by JS -->
        </div>

        <div class="graph-shell">
          <div class="graph-top-row">
            <span>Current multiplier</span>
            <span id="crash-hint">Crash point: hidden</span>
          </div>
          <div id="multiplier" class="multiplier">1.00x</div>

          <div class="graph-canvas-wrap">
            <canvas id="crash-canvas"></canvas>
            <div id="rocket" class="rocket"></div>
            <div class="axis-labels">
              <span>1.0x</span>
              <span>2.0x</span>
              <span>5.0x</span>
              <span>10.0x</span>
            </div>
          </div>
        </div>

        <div class="bet-panel">
          <div class="field">
            <label for="bet-amount">
              Bet amount
              <small id="max-bet-label">Max: 100</small>
            </label>
            <input id="bet-amount" type="number" min="1" step="1" value="10" />
            <div class="pill-row">
              <button class="btn-pill" data-bet="5">+5</button>
              <button class="btn-pill" data-bet="10">+10</button>
              <button class="btn-pill" data-bet="25">+25</button>
              <button class="btn-pill" data-bet="50">+50</button>
              <button class="btn-pill" data-bet="max">Max</button>
            </div>
          </div>

          <div class="field">
            <label for="auto-cashout">
              Auto cashout (x)
              <small>Optional</small>
            </label>
            <input
              id="auto-cashout"
              type="number"
              min="1.01"
              step="0.01"
              placeholder="e.g. 2.00"
            />
            <div class="pill-row">
              <button class="btn-pill" data-auto="1.50">1.50x</button>
              <button class="btn-pill" data-auto="2.00">2.00x</button>
              <button class="btn-pill" data-auto="3.00">3.00x</button>
              <button class="btn-pill" data-auto="5.00">5.00x</button>
            </div>
          </div>

          <div class="field">
            <label>Round controls</label>
            <div class="btn-row-main">
              <button id="btn-auto" class="btn btn-ghost tiny">Auto play: Off</button>
              <button id="btn-cashout" class="btn btn-ghost danger" disabled>Cash out</button>
              <button id="btn-start" class="btn btn-primary">Place bet</button>
            </div>
            <small id="round-tip" style="margin-top:4px;">
              Click <strong>Place bet</strong> to join the next round. Use <strong>Cash out</strong>
              while the rocket is flying.
            </small>
          </div>
        </div>
      </section>

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <section class="card">
          <div class="balance-line">
            <span>Demo balance</span>
            <span id="balance" class="balance-amount">$1,000.00</span>
          </div>
          <p class="note">
            Credits are <strong>virtual</strong>. Refresh the page to reset everything and start again.
          </p>

          <div class="metrics">
            <div class="metric-small">
              <div class="metric-label">Total wagered</div>
              <div id="stat-wagered" class="metric-value">$0.00</div>
            </div>
            <div class="metric-small">
              <div class="metric-label">Total profit</div>
              <div id="stat-profit" class="metric-value">$0.00</div>
            </div>
            <div class="metric-small">
              <div class="metric-label">Sample RTP</div>
              <div id="stat-rtp" class="metric-value">–</div>
            </div>
          </div>

          <div class="history-title">
            <span>Round history (latest first)</span>
            <button id="btn-clear-history" class="btn-ghost tiny" type="button">
              Clear
            </button>
          </div>
          <div id="history" class="history">
            <!-- Filled by JS -->
          </div>
        </section>

        <section class="info-card">
          <h3>What this demo shows</h3>
          <ul>
            <li>Classic Crash curve: multiplier starts at 1.00x and climbs until it explodes.</li>
            <li>Manual and automatic cashout options with virtual money.</li>
            <li>Result bar similar to real casino Crash lobbies.</li>
          </ul>
          <p>
            Use it to test simple strategies, not to chase “perfect” systems — there’s no way to
            predict the next crash point.
          </p>
        </section>
      </aside>
    </section>

    <!-- TEXT / SEO BLOCK -->
    <section class="text-content">
      <article>
        <h2>How the Crash casino game works</h2>
        <p>
          In most Crash casino games, a round starts at <strong>1.00x</strong>. A rocket, plane or
          line climbs upwards and the multiplier grows in real time. Players choose when to cash
          out. If they exit before the crash happens, their stake is multiplied by the current
          value. If the rocket explodes first, the whole bet is lost.
        </p>
        <p>
          This demo uses the same idea. Each round secretly picks a crash value between roughly
          <strong>1.00x and 10.00x</strong>. While the rocket flies, the multiplier rises
          on an exponential-like curve. You can either rely on <strong>auto cashout</strong> or
          press the button manually.
        </p>

        <h3>Typical Crash-style features replicated here</h3>
        <ul>
          <li>Bet panel with quick chips (+5, +10, +25, Max).</li>
          <li>Auto cashout shortcuts (1.5x, 2x, 3x, 5x).</li>
          <li>Color-coded last results bar: low, medium and high hits.</li>
          <li>Round history with profit / loss per round in virtual credits.</li>
        </ul>
        <p>
          If you enable <strong>Auto play</strong>, the demo will automatically join the next
          round whenever your balance is high enough. This behaves similarly to auto-bet options
          inside casino lobbies, but stays completely client-side.
        </p>
      </article>

      <article>
        <h2>Using the demo safely and realistically</h2>
        <p>
          Real-money Crash games add a house edge, more complex risk management and multi-player
          dynamics. This browser version skips all of that and focuses purely on the visual and
          mathematical behaviour of rounds.
        </p>

        <h3>Good ways to use this page</h3>
        <ul>
          <li>Experiment with fixed exit points like 1.5x, 2x or 3x.</li>
          <li>
            Track how your balance moves over 50–100 rounds with a certain rule (for example,
            “always cash at 2x”).
          </li>
          <li>Teach friends how volatile Crash can be without risking actual money.</li>
        </ul>
        <p>
          If you embed this demo next to casino reviews or educational articles, keep a clear
          <strong>responsible gaming</strong> disclaimer and stress that no pattern can guarantee
          profit. At best, strategy can help you manage risk and walk away earlier.
        </p>
      </article>
    </section>
  </main>

  <footer>
    This Crash casino game demo is for <strong>education and entertainment only</strong>.
    It does not accept deposits, pay out winnings, or simulate any specific operator’s odds.
    Check your local laws and always gamble responsibly.
  </footer>

  <script>
    (function () {
      // DOM elements
      const canvas = document.getElementById("crash-canvas");
      const rocketEl = document.getElementById("rocket");
      const multiplierEl = document.getElementById("multiplier");
      const crashHintEl = document.getElementById("crash-hint");
      const roundIdEl = document.getElementById("round-id");
      const phasePill = document.getElementById("phase-pill");
      const phaseLabel = document.getElementById("phase-label");
      const phaseCountdown = document.getElementById("phase-countdown");
      const betInput = document.getElementById("bet-amount");
      const autoInput = document.getElementById("auto-cashout");
      const maxBetLabel = document.getElementById("max-bet-label");
      const btnStart = document.getElementById("btn-start");
      const btnCashout = document.getElementById("btn-cashout");
      const btnAuto = document.getElementById("btn-auto");
      const btnClearHistory = document.getElementById("btn-clear-history");
      const roundTip = document.getElementById("round-tip");
      const balanceEl = document.getElementById("balance");
      const historyEl = document.getElementById("history");
      const lastMultsEl = document.getElementById("last-mults");
      const statWagered = document.getElementById("stat-wagered");
      const statProfit = document.getElementById("stat-profit");
      const statRtp = document.getElementById("stat-rtp");

      const ctx = canvas.getContext("2d");

      // State
      let roundId = 1;
      let phase = "idle"; // idle | betting | running | crashed | cashed
      let balance = 1000;
      let baseBalance = 1000;
      let totalWagered = 0;
      let totalReturned = 0;
      let currentBet = 0;
      let currentMultiplier = 1.0;
      let crashPoint = null;
      let startTimestamp = 0;
      let animReq = null;
      let bettingCountdown = 0;
      let nextRoundTimeout = null;
      let autoPlay = false;
      let lastMults = [];
      let canvasWidth = 0;
      let canvasHeight = 0;

      function resizeCanvas() {
        const rect = canvas.parentElement.getBoundingClientRect();
        canvasWidth = rect.width;
        canvasHeight = rect.height;
        canvas.width = canvasWidth * window.devicePixelRatio;
        canvas.height = canvasHeight * window.devicePixelRatio;
        ctx.setTransform(window.devicePixelRatio, 0, 0, window.devicePixelRatio, 0, 0);
        drawBackground();
      }

      function drawBackground() {
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        ctx.save();
        ctx.strokeStyle = "rgba(255,255,255,0.08)";
        ctx.lineWidth = 1;

        // Axes
        ctx.beginPath();
        ctx.moveTo(30, canvasHeight - 30);
        ctx.lineTo(canvasWidth - 20, canvasHeight - 30);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(30, canvasHeight - 30);
        ctx.lineTo(30, 20);
        ctx.stroke();

        // Grid lines (simple)
        ctx.setLineDash([4, 6]);
        ctx.beginPath();
        ctx.moveTo(30, canvasHeight - 110);
        ctx.lineTo(canvasWidth - 20, canvasHeight - 110);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(30, canvasHeight - 170);
        ctx.lineTo(canvasWidth - 20, canvasHeight - 170);
        ctx.stroke();

        ctx.setLineDash([]);
        ctx.restore();
      }

      function formatMoney(val) {
        return "$" + val.toFixed(2);
      }

      function updateBalanceDisplay() {
        balanceEl.textContent = formatMoney(balance);
        balanceEl.classList.remove("positive", "negative");
        if (balance > baseBalance) balanceEl.classList.add("positive");
        else if (balance < baseBalance) balanceEl.classList.add("negative");

        const max = Math.max(1, Math.floor(balance));
        maxBetLabel.textContent = "Max: " + max;
      }

      function updateStatsDisplay() {
        statWagered.textContent = formatMoney(totalWagered);
        const profit = balance - baseBalance;
        statProfit.textContent = formatMoney(profit);
        const rtp = totalWagered > 0 ? (totalReturned / totalWagered) * 100 : null;
        statRtp.textContent = rtp === null ? "–" : rtp.toFixed(1) + "%";
      }

      function setPhase(newPhase, extra) {
        phase = newPhase;
        phasePill.className = "phase-pill";
        phaseCountdown.textContent = "";

        switch (newPhase) {
          case "betting":
            phasePill.classList.add("phase-betting");
            phaseLabel.textContent = "Betting";
            if (typeof extra === "number") {
              phaseCountdown.textContent = extra.toFixed(0) + "s";
            }
            break;
          case "running":
            phasePill.classList.add("phase-running");
            phaseLabel.textContent = "Live";
            break;
          case "crashed":
            phasePill.classList.add("phase-crashed");
            phaseLabel.textContent = "Crashed";
            break;
          case "cashed":
            phasePill.classList.add("phase-running");
            phaseLabel.textContent = "Cashed out";
            break;
          default:
            phasePill.classList.add("phase-idle");
            phaseLabel.textContent = "Waiting";
        }
      }

      function resetRocketPosition() {
        rocketEl.style.transform = "translate(-9999px, -9999px)";
      }

      function drawCurve(maxMulti) {
        drawBackground();
        ctx.save();
        const originX = 30;
        const originY = canvasHeight - 30;
        const maxX = canvasWidth - 30;
        const maxY = 20;

        ctx.strokeStyle = "rgba(255,184,0,0.7)";
        ctx.lineWidth = 2;

        ctx.beginPath();
        const steps = 80;
        for (let i = 0; i <= steps; i++) {
          const t = i / steps;
          const m = 1 + (maxMulti - 1) * t;
          const x = originX + (maxX - originX) * t;
          const k = Math.log(m) / Math.log(maxMulti);
          const y = originY - (originY - maxY) * k;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.stroke();
        ctx.restore();
      }

      function placeRocket(multiplier, maxMulti) {
        const originX = 30;
        const originY = canvasHeight - 30;
        const maxX = canvasWidth - 30;
        const maxY = 20;

        const t = Math.min(multiplier / maxMulti, 1);
        const x = originX + (maxX - originX) * t;
        const k = Math.log(multiplier) / Math.log(maxMulti || 10);
        const y = originY - (originY - maxY) * k;

        rocketEl.style.transform = `translate(${x - 13}px, ${y - 13}px)`;
      }

      function updateMultiplierDisplay(stateClass) {
        multiplierEl.textContent = currentMultiplier.toFixed(2) + "x";
        multiplierEl.classList.remove("crashed", "cashed");
        if (stateClass) multiplierEl.classList.add(stateClass);
      }

      function addHistoryRow(multi, change, didCashout) {
        const row = document.createElement("div");
        row.className = "history-row";

        const mSpan = document.createElement("span");
        mSpan.className = "history-multi";
        mSpan.textContent = multi.toFixed(2) + "x";

        const changeSpan = document.createElement("span");
        if (change >= 0 && didCashout) {
          changeSpan.className = "history-win";
          changeSpan.textContent = "+" + formatMoney(change);
        } else {
          changeSpan.className = "history-loss";
          changeSpan.textContent = "-" + formatMoney(currentBet);
        }

        const tag = document.createElement("span");
        tag.className = "history-tag";
        tag.textContent = didCashout ? "Cashed out" : "Crashed";

        row.appendChild(mSpan);
        row.appendChild(changeSpan);
        row.appendChild(tag);

        historyEl.insertBefore(row, historyEl.firstChild);
        while (historyEl.children.length > 60) {
          historyEl.removeChild(historyEl.lastChild);
        }
      }

      function updateLastMults(multi) {
        lastMults.unshift(multi);
        if (lastMults.length > 12) lastMults.pop();
        lastMultsEl.innerHTML = "";
        if (!lastMults.length) return;

        lastMults.forEach((m) => {
          const chip = document.createElement("span");
          chip.className = "multi-chip";
          if (m < 2) chip.classList.add("multi-low");
          else if (m < 5) chip.classList.add("multi-mid");
          else chip.classList.add("multi-high");
          chip.textContent = m.toFixed(2) + "x";
          lastMultsEl.appendChild(chip);
        });
      }

      function startBettingPhase() {
        if (phase === "running") return;
        if (nextRoundTimeout) {
          clearTimeout(nextRoundTimeout);
          nextRoundTimeout = null;
        }

        bettingCountdown = 4;
        setPhase("betting", bettingCountdown);

        btnStart.disabled = true; // мы уже в ставке
        btnCashout.disabled = true;

        roundTip.innerHTML =
          "Bet locked for this round. Next: rocket launch in a few seconds.";

        const interval = setInterval(() => {
          bettingCountdown -= 1;
          if (bettingCountdown <= 0) {
            clearInterval(interval);
            startLivePhase();
          } else {
            setPhase("betting", bettingCountdown);
          }
        }, 1000);
      }

      function startLivePhase() {
        // Prepare crash
        const minCrash = 1.01;
        const maxCrashVal = 10;
        crashPoint = minCrash + Math.random() * (maxCrashVal - minCrash);
        crashPoint = parseFloat(crashPoint.toFixed(2));

        currentMultiplier = 1.0;
        updateMultiplierDisplay();
        crashHintEl.textContent = "Crash point: hidden";

        drawBackground();
        drawCurve(10);
        placeRocket(1, 10);

        setPhase("running");
        btnCashout.disabled = false;
        roundTip.innerHTML =
          "Rocket is live. Press <strong>Cash out</strong> or let auto cashout trigger.";

        startTimestamp = performance.now();
        if (animReq) cancelAnimationFrame(animReq);
        animReq = requestAnimationFrame(stepLive);
      }

      function stepLive(timestamp) {
        if (phase !== "running") return;

        const elapsed = (timestamp - startTimestamp) / 1000;
        // Growth: 1 + (t^1.7 * 0.9) — быстрый рост, но не слишком
        const growth = 1 + Math.pow(elapsed * 1.33, 1.7);
        currentMultiplier = Math.max(1.0, growth);

        // Auto cashout check
        const autoVal = parseFloat(autoInput.value);
        const hasAuto = Number.isFinite(autoVal) && autoVal >= 1.01;
        if (hasAuto && currentMultiplier >= autoVal) {
          doCashout(true);
          return;
        }

        if (currentMultiplier >= crashPoint) {
          currentMultiplier = crashPoint;
          doCrash();
          return;
        }

        updateMultiplierDisplay();
        drawBackground();
        drawCurve(10);
        placeRocket(currentMultiplier, 10);

        animReq = requestAnimationFrame(stepLive);
      }

      function doCashout(autoTriggered) {
        if (phase !== "running") return;
        setPhase("cashed");
        if (animReq) {
          cancelAnimationFrame(animReq);
          animReq = null;
        }

        // Выигрыш = ставка * множитель (ставка уже вычтена)
        const winAmount = currentBet * currentMultiplier;
        balance += winAmount;
        totalReturned += winAmount;

        updateBalanceDisplay();
        updateStatsDisplay();

        updateMultiplierDisplay("cashed");
        drawBackground();
        drawCurve(10);
        placeRocket(currentMultiplier, 10);

        crashHintEl.textContent =
          "You cashed out at " + currentMultiplier.toFixed(2) + "x";

        addHistoryRow(currentMultiplier, winAmount - currentBet, true);
        updateLastMults(currentMultiplier);

        roundTip.innerHTML =
          "You exited at <strong>" +
          currentMultiplier.toFixed(2) +
          "x</strong>. Profit added to your demo balance.";

        currentBet = 0;
        btnCashout.disabled = true;

        scheduleNextRound();
      }

      function doCrash() {
        if (phase !== "running" && phase !== "cashed") return;
        setPhase("crashed");
        if (animReq) {
          cancelAnimationFrame(animReq);
          animReq = null;
        }

        updateMultiplierDisplay("crashed");
        drawBackground();
        drawCurve(10);
        placeRocket(currentMultiplier, 10);

        crashHintEl.textContent =
          "Crashed at " + crashPoint.toFixed(2) + "x";

        addHistoryRow(currentMultiplier, 0, false);
        updateLastMults(currentMultiplier);

        roundTip.innerHTML =
          "Rocket exploded at <strong>" +
          crashPoint.toFixed(2) +
          "x</strong>. Your bet for this round was lost.";

        currentBet = 0;
        btnCashout.disabled = true;

        scheduleNextRound();
      }

      function scheduleNextRound() {
        resetRocketPosition();
        const delay = 3.5; // seconds
        let remaining = delay;

        setPhase("idle");
        btnStart.disabled = false;
        if (!autoPlay) {
          roundTip.innerHTML +=
            " Next round will be ready in a few seconds.";
        }

        if (nextRoundTimeout) {
          clearTimeout(nextRoundTimeout);
        }

        const countdownTick = () => {
          remaining -= 1;
          if (remaining <= 0) {
            phaseCountdown.textContent = "";
          } else {
            phaseCountdown.textContent = remaining.toFixed(0) + "s";
          }
        };

        countdownTick();
        const interval = setInterval(() => {
          countdownTick();
          if (remaining <= 0) clearInterval(interval);
        }, 1000);

        nextRoundTimeout = setTimeout(() => {
          roundId += 1;
          roundIdEl.textContent = "#" + roundId;
          setPhase("idle");
          if (autoPlay && balance > 0) {
            // Автоигра — ставим ещё раз с тем же размером
            placeBetAndStart();
          }
        }, delay * 1000);
      }

      function placeBetAndStart() {
        if (phase === "running" || phase === "betting") return;
        let betVal = parseFloat(betInput.value);
        const max = Math.floor(balance);
        if (!Number.isFinite(betVal) || betVal <= 0) {
          alert("Enter a valid bet amount greater than zero.");
          return;
        }
        if (betVal > max) {
          alert("Bet is larger than your available balance.");
          return;
        }

        betVal = Math.floor(betVal);
        currentBet = betVal;
        balance -= betVal;
        totalWagered += betVal;

        updateBalanceDisplay();
        updateStatsDisplay();

        roundTip.innerHTML =
          "Bet locked: <strong>" +
          formatMoney(currentBet) +
          "</strong>. Get ready for the next launch.";
        startBettingPhase();
      }

      // Events
      btnStart.addEventListener("click", () => {
        if (phase === "running") return;
        placeBetAndStart();
      });

      btnCashout.addEventListener("click", () => {
        if (phase === "running") {
          doCashout(false);
        }
      });

      btnAuto.addEventListener("click", () => {
        autoPlay = !autoPlay;
        btnAuto.textContent = "Auto play: " + (autoPlay ? "On" : "Off");
        if (autoPlay && phase === "idle" && balance > 0 && currentBet === 0) {
          placeBetAndStart();
        }
      });

      btnClearHistory.addEventListener("click", () => {
        historyEl.innerHTML = "";
        lastMults = [];
        lastMultsEl.innerHTML = "";
      });

      // Quick bet buttons
      document.querySelectorAll(".btn-pill[data-bet]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const type = btn.getAttribute("data-bet");
          if (type === "max") {
            betInput.value = Math.floor(balance);
          } else {
            const add = parseInt(type, 10);
            const current = parseFloat(betInput.value) || 0;
            const max = Math.floor(balance);
            betInput.value = Math.min(current + add, max);
          }
        });
      });

      // Auto cashout shortcuts
      document.querySelectorAll(".btn-pill[data-auto]").forEach((btn) => {
        btn.addEventListener("click", () => {
          autoInput.value = btn.getAttribute("data-auto");
        });
      });

      window.addEventListener("resize", resizeCanvas);

      // Init
      resizeCanvas();
      drawBackground();
      updateBalanceDisplay();
      updateStatsDisplay();
      setPhase("idle");
      roundIdEl.textContent = "#" + roundId;
      roundTip.innerHTML =
        "Set your bet, optionally choose auto cashout, then click <strong>Place bet</strong> to queue for the next round.";
    })();
  </script>
</body>
</html>
